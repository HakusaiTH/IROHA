<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>藤原 彩葉</title>
  <meta name="description" content="僕の愛する君へ—思い出、写真、カウントダウン。" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #eaf6ff;
      --panel: #ffffff;
      --panel-2: #f0faff;
      --text: #103050;
      --muted: #456;
      --primary: #0099ff;
      --primary-2: #4db8ff;
      --ring: rgba(0,153,255,.4);
      --shadow: 0 6px 20px rgba(0, 153, 255, 0.15);
      --radius: 18px;
      --radius-sm: 14px;
      --maxw: 1200px;
    }

    body {
      font-family: 'Noto Sans JP', sans-serif;
      background: linear-gradient(180deg, #dff4ff, #eaf6ff);
      color: var(--text);
      margin: 0;
      line-height: 1.6;
    }

    .container { max-width: var(--maxw); margin: 0 auto; padding: 0 16px; }

    header.site-header {
      background: linear-gradient(90deg, #0099ff, #4db8ff);
      color: #fff;
      padding: 12px 0;
      text-align: center;
      font-weight: 700;
      font-size: 18px;
      box-shadow: var(--shadow);
    }

    .hero {
      position: relative;
      margin: 20px auto;
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: var(--shadow);
    }
    .hero img {
      width: 100%;
      height: clamp(250px, 40vw, 420px);
      object-fit: cover;
      display: block;
    }
    .hero-text {
      position: absolute;
      bottom: 0; left: 0; right: 0;
      padding: 20px;
      background: linear-gradient(180deg, rgba(0,0,0,0) 0%, rgba(0,153,255,0.7) 80%);
      color: #fff;
    }
    .hero-text h1 { margin: 0 0 8px; font-size: clamp(20px, 3.2vw, 32px); }

    .section { margin: 40px 0; }
    .section-head { display:flex; align-items:center; justify-content:space-between; margin-bottom: 16px; }
    .section-head h2 { font-size: 24px; margin: 0; color: var(--primary); }
    .section-head .bar { flex:1; height: 2px; background: var(--primary-2); margin-left: 12px; }

    .cards { display:grid; grid-template-columns: repeat(auto-fit, minmax(260px,1fr)); gap: 20px; }
    .card { background: var(--panel); border-radius: var(--radius); padding: 20px; box-shadow: var(--shadow); text-align: center; }
    .card h3 { margin: 10px 0; }
    .counter { font-size: 20px; font-weight: 700; color: var(--primary); }
    .meta { font-size: 14px; color: var(--muted); }
    .chip { display:inline-block; background: var(--primary-2); color: #fff; padding: 4px 10px; border-radius: 999px; font-size: 12px; margin-bottom: 6px; }

    .grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 16px; }
    .grid-item { background: var(--panel-2); padding: 16px; border-radius: var(--radius-sm); box-shadow: var(--shadow); cursor: pointer; transition: transform .2s; }
    .grid-item:hover { transform: translateY(-3px); }
    .grid-item h3 { margin: 0 0 8px; font-size: 16px; color: var(--primary); }
    .content-text { color: var(--muted); overflow:hidden; display:-webkit-box; -webkit-line-clamp:3; -webkit-box-orient:vertical; }
    .datetime { font-size: 12px; color: var(--muted); margin-top: 8px; }

    .modal { position: fixed; inset: 0; display: none; place-items: center; background: rgba(0,153,255,0.3); backdrop-filter: blur(6px); z-index: 999; }
    .modal.open { display: grid; }
    .modal-card { background: var(--panel); padding: 20px; border-radius: var(--radius); max-width: 600px; width: 90%; box-shadow: var(--shadow); position: relative; }
    .btn { border:none; background: var(--primary); color: #fff; padding: 8px 16px; border-radius: 8px; cursor:pointer; position: absolute; top: 12px; right: 12px; }

    .gallery { columns: 1; column-gap: 16px; }
    @media(min-width:600px){ .gallery{columns:2;} }
    @media(min-width:900px){ .gallery{columns:3;} }
    .photo { break-inside: avoid; margin-bottom:16px; border-radius: var(--radius-sm); overflow:hidden; box-shadow: var(--shadow); margin: 8px; }
    .photo img { width: 100%; height: auto; display:block; border-radius: var(--radius-sm); }

    footer { text-align:center; padding: 20px; color: #fff; font-size: 14px; background: linear-gradient(90deg, #0099ff, #4db8ff); margin-top: 40px; }
  </style>
</head>
<body>
  <header class="site-header">藤原 彩葉</header>

  <main class="container">
    <section class="hero">
      <img src="/image/1695450254130.jpg" alt="Snow" />
      <div class="hero-text">
        <h1>僕の愛する君へ</h1>
        <p>新年あけましておめでとうございます。今年も一緒に歩んでいけることを嬉しく思います。これからも互いに支え合い、愛と幸せで満ちた日々を過ごしていきましょう。君のことが大好きです。</p>
      </div>
    </section>

    <section class="section">
      <div class="section-head"><h2>Count Down</h2><div class="bar"></div></div>
      <div class="cards">
        <div class="card">
          <div class="chip">Birth Day</div>
          <h3>Birth Day Countdown</h3>
          <div id="birthdayCountdown" class="counter">—</div>
          <div class="meta">Age: <span id="age">—</span> Years</div>
        </div>
        <div class="card">
          <div class="chip">Anniversary</div>
          <h3>Anniversary Countdown</h3>
          <div id="anniversaryCountdown" class="counter">—</div>
          <div class="meta">Anniversary in <span id="anniversaryYears">—</span></div>
        </div>
      </div>
    </section>

    <section class="section">
      <div class="section-head"><h2>MEMORY</h2><div class="bar"></div></div>
      <div class="grid" id="contentGrid"></div>
    </section>

    <section class="section">
      <div class="section-head"><h2>IMAGES</h2><div class="bar"></div></div>
      <div class="gallery" id="imageGrid"></div>
    </section>
  </main>

  <div id="gridItemAll" class="modal">
    <div class="modal-card">
      <button class="btn" id="closeModal">×</button>
      <h3 id="modalTitle">—</h3>
      <div id="modalBody"></div>
      <div id="modalTime" class="datetime"></div>
    </div>
  </div>

  <footer>© 2024 Fujiwara Aoyama.</footer>

  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script>
    const BIRTH = { year: 2006, monthIndex: 11, day: 23 };
    const ANNIV = { year: 2022, monthIndex: 10, day: 19 };

    function nextOccurrence(monthIndex, day, now=new Date()){
      let target = new Date(now.getFullYear(), monthIndex, day);
      if(target<=now) target = new Date(now.getFullYear()+1, monthIndex, day);
      return target;
    }
    function formatDuration(ms){
      if(ms<=0) return 'Today!';
      const totalSec=Math.floor(ms/1000);
      const d=Math.floor(totalSec/86400);
      const h=Math.floor((totalSec%86400)/3600);
      const m=Math.floor((totalSec%3600)/60);
      const s=totalSec%60;
      return `${d} Days, ${h} Hours, ${m} Minutes, ${s} Seconds`;
    }
    function calcAge(birth, now=new Date()){
      let age=now.getFullYear()-birth.year;
      const thisYear=new Date(now.getFullYear(),birth.monthIndex,birth.day);
      if(now<thisYear) age--;
      return age;
    }
    function calcYearsTogether(start, now=new Date()){
      let years=now.getFullYear()-start.year;
      const thisYear=new Date(now.getFullYear(),start.monthIndex,start.day);
      if(now<thisYear) years--;
      return years;
    }
    function tick(){
      const now=new Date();
      const nextBDay=nextOccurrence(BIRTH.monthIndex,BIRTH.day,now);
      const nextAnniv=nextOccurrence(ANNIV.monthIndex,ANNIV.day,now);
      document.getElementById('birthdayCountdown').textContent=formatDuration(nextBDay-now);
      document.getElementById('age').textContent=calcAge(BIRTH,now);
      document.getElementById('anniversaryCountdown').textContent=formatDuration(nextAnniv-now);
      document.getElementById('anniversaryYears').textContent=calcYearsTogether(ANNIV,now)+" Years";
    }
    setInterval(tick,1000); tick();

    const firebaseConfig={ apiKey:"AIzaSyC4goQXBFiCXrJv715ZQ8DfzG27w7KHkjU",authDomain:"fujiwara-2c925.firebaseapp.com",projectId:"fujiwara-2c925",storageBucket:"fujiwara-2c925.firebasestorage.app",messagingSenderId:"846326685482",appId:"1:846326685482:web:4ea480b3a99a98a7d9c853",measurementId:"G-4XK8PP0Q7C",databaseURL:"https://fujiwara-2c925-default-rtdb.asia-southeast1.firebasedatabase.app"};
    const app=firebase.initializeApp(firebaseConfig);
    const db=firebase.database(app);

    db.ref('contents').on('value',snap=>{
      const grid=document.getElementById('contentGrid'); grid.innerHTML='';
      snap.forEach(c=>{
        const d=c.val();
        const item=document.createElement('div');
        item.className='grid-item';
        item.innerHTML=`<h3>${d.title||''}</h3><p class="content-text">${d.content||''}</p><div class="datetime">${d.dateTime||''}</div>`;
        item.addEventListener('click',()=>openModal(d.title,d.content,d.dateTime));
        grid.appendChild(item);
      });
    });

    db.ref('images').on('value',snap=>{
      const grid=document.getElementById('imageGrid'); grid.innerHTML='';
      snap.forEach(c=>{
        const d=c.val();
        const a=document.createElement('a');
        a.href=d.imageUrl; a.target='_blank'; a.rel='noopener';
        a.className='photo';
        a.innerHTML=`<img src="${d.imageUrl}" alt="Photo" loading="lazy">`;
        grid.appendChild(a);
      });
    });

    const modal=document.getElementById('gridItemAll');
    const modalTitle=document.getElementById('modalTitle');
    const modalBody=document.getElementById('modalBody');
    const modalTime=document.getElementById('modalTime');
    document.getElementById('closeModal').addEventListener('click',()=>modal.classList.remove('open'));
    function openModal(title,body,time){
      modalTitle.textContent=title;
      modalBody.textContent=body;
      modalTime.textContent=time;
      modal.classList.add('open');
    }
    modal.addEventListener('click',e=>{ if(e.target===modal) modal.classList.remove('open'); });
  </script>
</body>
</html>
